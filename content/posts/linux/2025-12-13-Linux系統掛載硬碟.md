---
title: "Linux 系統掛載硬碟"
date: 2025-12-13 09:25:00 +0800
categories: 
  - Linux
tags:
  - Linux
---

要將硬碟掛載到 Linux 系統，若是要用全新的硬碟或清空所有資料，可先進行格式化。若是掛載既有資料的硬碟，則要注意使用者權限。

## 格式化硬碟

{{< alert type="warning" >}}
一旦進行格式化，硬碟上的所有資料將永久清除，無法復原。
請務必

1. 備份好資料。
2. 仔細檢查硬碟代號。
{{< /alert >}}

### 識別硬碟代號

首先識別硬碟代號，可用`sudo fdisk -l` 或 `lsblk` 指令。

- `fdisk -l` 列出所有磁碟與分割區資訊。
- `lsblk` 以樹狀結構顯示磁碟資訊，更容易看出磁碟空間大小和分割狀況。

```bash
sudo fdisk -l
# 或
lsblk
```

假設新加入的硬碟代號是 `/dev/sdx`。

### 建立 GPT 分割表與單一分割區

建議使用 `parted` 工具建立 GPT(GUID Partition Table)。

操作如下

```bash
# 用 parted 針對 /dev/sdx 進行操作，以下指令將進入 parted 指令介面
parted /dev/sdx


# 在 parted 介面進行以下操作

# 建立 GPT 磁碟標籤。（警告：此操作會清除所有舊有分割表資訊）
mklabel gpt 

# 建立一個主分割區
# 0% parted 會自動對齊磁區。
# 100% 代表使用到所有硬碟空間。
mkpart primary 0% 100%

# 檢查分割區是否建立成功。
print
# 應該會看到一個單一的分割區，例如 /dev/sdx1。

# 退出 parted 工具。
(parted) quit
```

### 使用 mkfs.ext4 格式化硬碟

使用 mkfs.ext4 指令將處理好的分割區 /dev/sdx1 格式化為 ext4 檔案系統。

```bash
sudo mkfs.ext4 /dev/sdx1
```

{{< alert type="warning" >}}
若加上 `-F` 可以強制格式化，但是使用強制格式化前必須再三確認所有設定與磁碟代號。
{{< /alert >}}

{{< alert type="info" >}}
若要格式化為其他檔案系統，可使用對應的 mkfs 指令。例如 mkfs.ntfs(格式化為ntfs)。
{{< /alert >}}

## 掛載硬碟

使用新的硬碟空間時，通常會在 /mnt 內建立掛載用的目錄。掛載硬碟可分為手動掛載或永久掛載。

- 手動掛載(暫時掛載)：每次開機時需要用 mount 指令將 /sdx/sdx1 掛載到目錄。
- 自動掛載：修改 `/etc/fstab`，讓系統開機時自動將硬碟掛載到目錄。

首先建立要掛載的目錄

```bash
# 建立 /mnt/new_storage 用來掛載硬碟
sudo mkdir /mnt/new_storage
```

### 手動掛載

使用 mount 指令手動掛載

```bash
# 手動掛載硬碟
sudo mount /dev/sdx1 /mnt/new_storage

# 使用 df 檢查 new_storage 目錄是否掛載成功
df -h | grep new_storage

# 將掛載的目錄設為目前使用者
sudo chown -R $USER:$USER /mnt/new_storage
```

#### 設定群組權限

若新掛載的目錄需要給多個使用者使用，建議會設定群組權限，例如有些 Linux 發行版預設有 users 群組。

```bash
# 將目錄群組改為 users
sudo chgrp -R users /mnt/new_storage

# 更改目錄權限
sudo chmod -R 775 /mnt/new_storage

# 若希望子目錄繼承權限則改用 2775
sudo chmod -R 2775 /mnt/new_storage
```

### 自動掛載

使用自動掛載，首先取得磁碟分割區的 UUID

```bash
sudo blkid /dev/sdx1

# 將 UUID 複製
```

接著編輯 `/etc/fstab` 設定檔

```conf
# 使用編輯軟體開啟 /etc/fstab
# 在檔案末端加上以下(欄位用空白或 tab 分隔)

# /dev/sdx1 for new_storage
UUID=<磁碟分割區的UUID> /mnt/new_storage ext4 defaults 0 2
```

欄位說明如下

- UUID=... 磁碟代號 (UUID 是最推薦的方式）
- /mnt/data_storage 掛載點目錄
- ext4 檔案系統類型
- defaults 掛載選項（通常使用預設值即可）
- 0 備份頻率 0 代表不備份（現代系統通常會使用其他工具進行備份）
- 2 檢查順序 2 代表在根目錄之後檢查

接著測試自動化掛載設定

```bash
# 若有手動掛載，則先取消掛載
# umount 也可指定裝置名稱 /sdx/sdx1，但建議指定掛載目錄比較不容易出錯
sudo umount /mnt/new_storage

# 讀取 /etc/fstab 檔案中的所有內容並嘗試掛載。
sudo mount -a

# 使用 df 檢查 new_storage 目錄是否掛載成功
df -h | grep new_stroage
```

若成功掛載，則每次系統開機都會自動將 /sdx/sdx1 掛載到 /mnt/new_storage。

## 移除硬碟

使用 umount 卸載硬碟目錄

```bash
sudo umount /mnt/new_storage
```

建議備份 /etc/fstab

```bash
sudo cp /etc/fstab /etc/fstab.bak
```

編輯 /etc/fstab

```conf
# 將要卸載的硬碟的 UUID 註解或移除
# UUID= ...
```

重新載入系統配置

```bash
# 重新載入 systemd
sudo systemctl daemon-reload

# 測試掛載
sudo mount -a
# 若沒有錯誤代表 fstab 設定正確
```

成功後即可關閉電腦，並將硬碟移除後重開。
